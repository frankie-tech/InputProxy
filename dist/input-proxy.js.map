{"version":3,"file":"input-proxy.js","sources":["../index.ts"],"sourcesContent":["// TODO: get deeply nested JSON values\n/*\nconst type = (obj: unknown) => Object.prototype.toString.call(obj);\n\nconst deepCheck = (object: object, keys: string[]) => {\n\tlet currObject = object;\n\tfor (let key of keys) {\n\t\tif (type(currObject) !== '[object Object]') break;\n\t\tif (key in currObject === false) break;\n\n\t\tcurrObject = currObject[key];\n\t}\n\n\treturn {\n\t\tresult: currObject,\n\t\tkeys,\n\t}\n}*/\n\ntype InputProxyOptions = {\n\tprevKey?: string;\n}\n\nexport default (el: HTMLInputElement, options: InputProxyOptions = {}) => {\n\tlet prevKey = options.prevKey || '__input_proxy_prev';\n\tel[prevKey] = {};\n\tlet p = new Proxy(el, {\n\t\tset(el: HTMLInputElement, key: string, value: unknown) {\n\n\t\t\tconst json = JSON.parse(el.value || '{}');\n\n\t\t\tif (key in json) el[prevKey][prevKey + '_' + key] = json[key];\n\n\t\t\tjson[key] = value;\n\t\t\tel.value = JSON.stringify(json);\n\n\t\t\treturn true;\n\t\t},\n\t\tget(el: HTMLInputElement, key: string) {\n\t\t\tif (key === '__value') return el.value;\n\t\t\tif (key === prevKey) return el[prevKey];\n\n\t\t\tconst json = JSON.parse(el.value || '{}');\n\n\t\t\tif (key in json === false) {\n\t\t\t\tconsole.warn('Missing key in value, returning null.');\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\treturn json[key];\n\t\t},\n\t\tdeleteProperty(el, key) {\n\t\t\tconst json = JSON.parse(el.value || '{}');\n\n\t\t\tif (key in json === false) {\n\t\t\t\tconsole.warn('Key was not in JSON, returning false.');\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tReflect.deleteProperty(json, key);\n\n\t\t\tif (key in json) throw Error('Key is still in JSON????');\n\n\t\t\treturn true;\n\t\t}\n\t});\n\n\treturn p;\n}\n"],"names":["el","options","prevKey","Proxy","set","key","value","json","JSON","parse","stringify","get","console","warn","deleteProperty","Reflect","Error"],"mappings":"AAuBA,OAAgBA,EAAsBC,EAA6B,MAClE,IAAIC,EAAUD,EAAQC,SAAW,qBA2CjC,OA1CAF,EAAGE,GAAW,GACN,IAAIC,MAAMH,EAAI,CACrBI,IAAIJ,EAAsBK,EAAaC,GAEtC,MAAMC,EAAOC,KAAKC,MAAMT,EAAGM,OAAS,MAOpC,OALID,KAAOE,IAAMP,EAAGE,GAASA,EAAU,IAAMG,GAAOE,EAAKF,IAEzDE,EAAKF,GAAOC,EACZN,EAAGM,MAAQE,KAAKE,UAAUH,OAI3BI,IAAIX,EAAsBK,GACzB,GAAY,YAARA,EAAmB,OAAOL,EAAGM,MACjC,GAAID,IAAQH,EAAS,OAAOF,EAAGE,GAE/B,MAAMK,EAAOC,KAAKC,MAAMT,EAAGM,OAAS,MAEpC,OAAID,KAAOE,GAAS,GACnBK,QAAQC,KAAK,+CAIPN,EAAKF,IAEbS,eAAed,EAAIK,GAClB,MAAME,EAAOC,KAAKC,MAAMT,EAAGM,OAAS,MAEpC,GAAID,KAAOE,GAAS,EAEnB,OADAK,QAAQC,KAAK,4CAMd,GAFAE,QAAQD,eAAeP,EAAMF,GAEzBA,KAAOE,EAAM,MAAMS,MAAM,4BAE7B"}